# Digital Ocean App Platform Configuration
# Deploy Year Grid Calendar WITHOUT GitHub integration
# Use this for manual deployments or when GitHub is not connected

name: year-grid-calendar

# Services
services:
  - name: web
    # Build from Dockerfile
    dockerfile_path: Dockerfile.do

    # Source: Use image registry or local source
    # When deploying via CLI without GitHub, DO will use local files

    # Run configuration
    run_command: uvicorn web.app:app --host 0.0.0.0 --port 8080

    # Environment variables
    envs:
      - key: PORT
        value: "8080"
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: TZ
        value: "UTC"

    # HTTP configuration
    http_port: 8080

    # Health check
    health_check:
      http_path: /health
      initial_delay_seconds: 20
      period_seconds: 30
      timeout_seconds: 10
      success_threshold: 1
      failure_threshold: 3

    # Instance size
    # Options: basic-xxs, basic-xs, basic-s, basic-m, professional-xs, professional-s, professional-m
    instance_size_slug: basic-xs
    instance_count: 1

    # Auto-scaling (optional - Professional plans only)
    # autoscaling:
    #   min_instance_count: 1
    #   max_instance_count: 3
    #   metrics:
    #     cpu:
    #       percent: 80

    # Routes
    routes:
      - path: /

# Domain configuration (optional - comment out if not ready)
domains:
  - domain: year-grid.ceesaxp.org
    type: PRIMARY
    zone: ceesaxp.org

# Region
region: nyc

# Alerts (optional)
alerts:
  - rule: DEPLOYMENT_FAILED
  - rule: DOMAIN_FAILED

# Features
features:
  - buildpack-stack=ubuntu-22
